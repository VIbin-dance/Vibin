<main role="main" class="container col-md-9 col-sm-10" style="margin-top:5%; margin-bottom: 5%;">
    <script type="text/javascript" src="https://js.stripe.com/v3/"></script>
    <%- include ('partials/messages') %>
        <div class="row">
            <div class="col-md-8 blog-main">
                <div class="blog-post">
                    <div class="card-deck">
                        <% if (!user.lesson && lesson.price != 0) { %>
                            <!-- <h3>今なら初回無料！<%= lesson.price %><%= __('dashboard.Yen') %>が0<%= __('dashboard.Yen') %>で！</h3> -->
                            <% } %>
                                <div class="card mb-3" style="min-width: 47vh; margin-top: 30px;">
                                    <img style="height: 100%; width: 100%; display: block;" src="<%=lesson.thumbnail%>" alt="thumbnail of the lesson">
                                </div>

                                <div class="p-3">
                                    <h4>
                                        <%= lesson.title %> by
                                            <a href="/choreographer/<%= choreographer._id %>">
                                                <%= choreographer.username %>
                                            </a>
                                    </h4>
                                    <ol class="list-unstyled">
                                        <li>
                                            <%= __(`dashboard.search.level.${lesson.level[0]}`) %> |
                                                <%= __(`dashboard.search.genre.${lesson.genre[0]}`) %> |
                                                    <%= __(`dashboard.search.mood.${lesson.mood[0]}`) %>
                                        </li>
                                    </ol>
                                    <h5>
                                        <%= lesson.price %>
                                            <%= __('dashboard.Yen') %> |
                                                <%=  moment(lesson.time).format('MM/DD HH:mm'); %>
                                                    </h6>
                                                    <hr>
                                                    <div class="text-center">
                                                        <% if (id != undefined) { %>
                                                            <button class="btn btn-danger btn-lg btn-block" id="checkout-button"><%= __('reservation.purchase') %></button>
                                                            <% } else { %>
                                                                <a href="/success/<%= params %>" class="btn btn-danger btn-lg btn-block">
                                                                    <%= __('reservation.purchase') %>
                                                                </a>
                                                                <% } %>
                                                    </div>
                                                    <hr>
                                                    <div class="text-center">
                                                        <h4>
                                                            <%= __('reservation.choreo') %>
                                                        </h4>
                                                        <a href="/choreographer/<%= choreographer._id %>" style="font-size: 22px;">
                                    <img src="<%= choreographer.userPhoto %>" height="100" width="100" style="border-radius: 50%;" alt="user photo">
                                    <br><%= choreographer.username %></a>
                                                        <br>
                                                        <h5 style="white-space:pre-wrap;">
                                                            <%= choreographer.bio %>
                                                        </h5>
                                                        <p class="mb-0">
                                                            <%= __('reservation.contact') %>:
                                                                <a href="mailto:<%= choreographer.email %>">
                                                                    <%= choreographer.email %>
                                                                </a>
                                                        </p>
                                                    </div>
                                </div>
                    </div>
                </div>
            </div>

            <aside class="col-md-4 blog-sidebar">
                <% if (newLesson.length) { %>
                    <section id="results" class="results">
                        <br><br>
                        <h4>
                            他にもオススメのレッスン&#10024;</h4>
                        <div class="row">
                            <% for(let i=0; i < newLesson.length; i++) { %>
                                <div class="col-lg-12 col-xs-6">
                                    <div class="box">
                                        <a href="/reservation/<%= newLesson[i]._id %>">
                                            <img src="<%= newLesson[i].thumbnail %>" alt="thumbnail">
                                        </a>
                                        <h4 id="title<%= i %>">
                                            <%= newLesson[i].title %>
                                        </h4>
                                        <a class="special" href="/choreographer/<%= newLesson[i].choreographerID %>">
                                            <%= newChoreographer[i].username %>
                                        </a>
                                        <p>
                                            <%= newLesson[i].price %>
                                                <%= __('dashboard.Yen') %> |
                                                    <%= moment(newLesson[i].time).format('MM/DD HH:mm'); %> |
                                                        <%= __(`dashboard.search.level.${newLesson[i].level[0]}`) %> |
                                                            <%= __(`dashboard.search.genre.${newLesson[i].genre[0]}`) %>
                                        </p>
                                    </div>
                                </div>
                                <% } %>
                        </div>
                    </section>
                    <% } %>
            </aside>
        </div>
</main>

<script>
    const stripe = Stripe('<%= stripePublicKey %>');
    const checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', () => {
        stripe.redirectToCheckout({
            sessionId: '<%= id %>'
        })
    });
</script>